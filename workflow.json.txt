{
  "nodes": [
    {
      "parameters": {},
      "id": "270631f4-3d92-4911-9a74-a698a8a4747c",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [
        360,
        300
      ],
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "const text = $json.message.text.trim();\nconst lines = text.split('\\n').map(line => line.trim()).filter(Boolean);\n\nlet type = \"\";\nlet clientData = {};\nlet items = [];\n\nlet currentItem = null;\n\nfor (let line of lines) {\n\t if (line.startsWith(\"نوع /\")) {\n\t\t type = line.split(\"/\")[1].trim().toLowerCase(); // يتم تحويل النوع لأحرف صغيرة هنا\n\t } else if (line.startsWith(\"اسم العميل /\")) {\n\t\t clientData.client = line.split(\"/\")[1].trim();\n\t } else if (line.startsWith(\"اسم الشركة /\")) {\n\t\t clientData.company = line.split(\"/\")[1].trim();\n\t } else if (line.startsWith(\"رقم التليفون /\")) {\n\t\t clientData.phone = line.split(\"/\")[1].trim();\n\t } else if (line.startsWith(\"العنوان /\")) {\n\t\t clientData.address = line.split(\"/\")[1].trim();\n\t } else if (line.startsWith(\"--- صنف ---\")) {\n\t\t if (currentItem) {\n\t\t\t items.push(currentItem);\n\t\t }\n\t\t currentItem = {};\n\t } else if (line.startsWith(\"الصنف /\")) {\n\t\t currentItem.items = line.split(\"/\")[1].trim();\n\t } else if (line.startsWith(\"الكمية /\")) {\n\t\t currentItem.quantity = Number(line.split(\"/\")[1].trim());\n\t } else if (line.startsWith(\"السعر /\")) {\n\t\t currentItem.price = Number(line.split(\"/\")[1].trim());\n\t } else if (line.startsWith(\"الباتش /\")) {\n\t\t currentItem.batch = line.split(\"/\")[1].trim();\n\t }\n}\n\n// إضافة آخر صنف\nif (currentItem) {\n\t items.push(currentItem);\n}\n\n// اسم الموظف من تليجرام\nconst employee = $json.message.from.first_name || \"غير معروف\";\n\n// إنشاء الصفوف\nconst output = items.map((item, index) => {\n\t let rowData = {\n\t\t type,\n\t\t ...item\n\t };\n\n\t // إضافة بيانات العميل والموظف فقط لأول صنف\n\t if (index === 0) {\n\t\t rowData = {\n\t\t\t employee,\n\t\t\t ...clientData,\n\t\t\t ...rowData\n\t\t };\n\t } else {\n\t\t // للأصناف اللاحقة، اجعل هذه الحقول فارغة\n\t\t rowData = {\n\t\t\t employee: '', // أو null حسب تفضيلك\n\t\t\t client: '',\n\t\t\t company: '',\n\t\t\t phone: '',\n\t\t\t address: '',\n\t\t\t ...rowData\n\t\t };\n\t }\n\n\t return {\n\t\t json: rowData\n\t };\n});\n\nreturn output;"
      },
      "id": "e44d5d1c-b710-410a-867c-17937446599b",
      "name": "Code",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        580,
        300
      ]
    },
    {
      "parameters": {
        "mode": "rules",
        "routingRules": [
          {
            "value1": "={{ $json.type }}",
            "operation": "isEqual",
            "value2": "عينات"  // قيمة القاعدة بأحرف صغيرة
          },
          {
            "value1": "={{ $json.type }}",
            "operation": "isEqual",
            "value2": "أوردرات" // قيمة القاعدة بأحرف صغيرة
          }
        ]
      },
      "id": "48154101-382a-436f-b44a-10103767f4c0",
      "name": "Switch",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        800,
        300
      ]
    },
    {
      "parameters": {
        "operation": "appendRow",
        "documentId": "1PZm8Ph70xQXWNLj7O6NbBILYtT3hUQzzxAFT5fkr-pE", // ID شيت الأوردرات
        "sheetName": "أوردرات",
        "mappingMode": "mapEachColumnManually",
        "valuesToSend": {
          "employee": "={{ $json.employee }}",
          "client": "={{ $json.client }}",
          "company": "={{ $json.company }}",
          "phone": "={{ $json.phone }}",
          "address": "={{ $json.address }}",
          "type": "={{ $json.type }}",
          "items": "={{ $json.items }}",
          "quantity": "={{ $json.quantity }}",
          "price": "={{ $json.price }}",
          "batch": "={{ $json.batch }}"
        }
      },
      "id": "31b26f58-c990-482f-8703-a17f22d6b31c",
      "name": "أوردرات",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 3,
      "position": [
        1040,
        220
      ],
      "credentials": {
        "googleSheetsApi": {
          "id": "YOUR_GOOGLE_SHEETS_CREDENTIAL_ID",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendRow",
        "documentId": "1PZm8Ph70xQXWNLj7O6NbBILYtT3hUQzzxAFT5fkr-pE", // ID شيت العينات
        "sheetName": "عينات",
        "mappingMode": "mapEachColumnManually",
        "valuesToSend": {
          "employee": "={{ $json.employee }}",
          "client": "={{ $json.client }}",
          "company": "={{ $json.company }}",
          "phone": "={{ $json.phone }}",
          "address": "={{ $json.address }}",
          "type": "={{ $json.type }}",
          "items": "={{ $json.items }}",
          "quantity": "={{ $json.quantity }}",
          "price": "={{ $json.price }}",
          "batch": "={{ $json.batch }}"
        }
      },
      "id": "b7d30128-48b4-406c-829d-4351659714a6",
      "name": "عينات",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 3,
      "position": [
        1040,
        380
      ],
      "credentials": {
        "googleSheetsApi": {
          "id": "YOUR_GOOGLE_SHEETS_CREDENTIAL_ID",
          "name": "Google Sheets account"
        }
      }
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Code",
            "input": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Switch",
            "input": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "عينات",
            "index": 0,
            "input": 0
          }
        ],
        [
          {
            "node": "أوردرات",
            "index": 1,
            "input": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "tags": [],
  "id": "YOUR_WORKFLOW_ID",
  "meta": {
    "instanceId": "YOUR_INSTANCE_ID"
  },
  "name": "EarthpuresalesBot",
  "createdAt": "2024-07-16T05:00:00.000Z",
  "updatedAt": "2024-07-16T05:00:00.000Z",
  "versionId": "YOUR_VERSION_ID"
}